<!DOCTYPE html>

<html>

<head>
    <title>Chat Room</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet">

    <link href="/css/chatstyle.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="//code.jquery.com/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <link href="https://use.fontawesome.com/45e03a14ce.css" media="all" rel="stylesheet">
    <!-- include jquery for preventDefault method Cancel the default action (navigation) of the click -->
     <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>-->
    <script src="https://use.fontawesome.com/45e03a14ce.js"></script>
</head>

<body>

    <!-- Backup
    <div class="container">
    <div class="row" id="pwd-container">
        <div class="col-xs-12 col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4">
        <section class="group-form">
            <form id = "group-form">
            <h2 align="center">Enter Group Name</h2>
            <div class="form-group">
                <label for="groupid_input">name</label>
                <input type="text" class="form-control input-lg" id="groupid_input" placeholder="Group ID">
            </div>
            <button type="submit" class="btn btn-lg btn-primary btn-block">Create</button>
            </form>
        </section>
        </div>
    </div>
    </div> -->
                <!--<form id="group_form">
                    <input type="text" id="groupid_input"></input>
                    <input type="submit"></input>
                </form> -->
     <!-- Backup
    <ul id="group_list">
    </ul>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io.connect('http://localhost:8080');

        //http://localhost:8080/clientid/chat - window.location.pathname = /clientid/chat
        socket.on('connect', function (data) {
            var clientid = window.location.pathname.split('/')[1];
            socket.emit('login', clientid);  
        });

        socket.on("add group", function (groupid) {
            var groupLi = $('<li data-name="' + groupid + '">' + groupid + '</li>').data('groupid', groupid);
            $('#group_list').append(groupLi);
        });

        $('#group-form').submit(function (e) {
            var groupid = $('#groupid_input').val();
            $('#groupid_input').val('');
            socket.emit('createGroup', groupid);
            var groupLi = $('<li data-name="' + groupid + '">' + groupid + '</li>').data('groupid', groupid);
            $('#group_list').append(groupLi);
            e.preventDefault();
        });
    </script>
    -->

<!-- ............................................................................... -->
<div class="main_section">
    <div class="container">
        <div class="chat_container">
            <div class="col-sm-3 chat_sidebar">
                <div class="row">
                    <div id="custom-search-input">
                        <div class="input-group col-md-12">
                            <input type="text" id="join_input" class="search-query form-control" placeholder="Join a Room" />
                            <button id="joinButton" class="btn btn-danger" type="button">
                            <span class="glyphicon glyphicon-search"></span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div id="custom-search-input">
                        <div class="input-group col-md-12">
                            <input type="text" id="groupid_input" class="search-query form-control" placeholder="Create a New Room" />
                            <button id="createButton" class="btn btn-danger" type="button">
                            <span class="glyphicon glyphicon-plus"></span>
                            </button>
                        </div>
                    </div>
                    <!-- /////////// group_list /////////// -->             
                    <div class="member_list">
                        <ul id="group_list" class="list-unstyled">
                            <li class="left clearfix">
                                <span class="chat-img pull-left">
                                <img src= "/img/icon-user-default.png" alt="User Avatar" class="img-circle">
                                </span>
                                <div class="chat-body clearfix">
                                    <div class="header_sec">
                                        <strong class="primary-font">John Cena</strong> <strong class="pull-right">
                                        09:45AM</strong>
                                    </div>
                                    <div class="contact_sec">
                                        <strong class="primary-font">(123) 123-456</strong> <span class="badge pull-right">3</span>
                                    </div>
                                </div>
                            </li>
                            
                            <li class="left clearfix">
                                <span class="chat-img pull-left">
                                <img src="/img/icon-user-default.png" alt="User Avatar" class="img-circle">
                                </span>
                                <div class="chat-body clearfix">
                                    <div class="header_sec">
                                        <strong class="primary-font">John Cena</strong> <strong class="pull-right">
                                        09:45AM</strong>
                                    </div>
                                    <div class="contact_sec">
                                        <strong class="primary-font">(123) 123-456</strong> <span class="badge pull-right">3</span>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <!-- /////////// end group_list /////////// -->   
                </div>
            </div>
            <!--/////////// chat_sidebar /////////// -->
            <div class="col-sm-9 message_section">
                <div class="row">
                    <div class="new_message_head">
                        <div id="room-name">
                            <u>Room 93</u>
                        </div>
                        <div id="dropdown-action" class="pull-right">
                            <div class="dropdown">
                                <button class="dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="fa fa-cogs" aria-hidden="true"></i>  Action <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
                                    <li>
                                        <div align="center">Signed in as: clientid <br><br></div>
                                    </li>
                                    <li><a href="#">Leave Room</a></li>
                                    <li><a href="#">Sign Out</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- /////////// new_message_head /////////// -->
                    <div class="chat_area">
                        <ul id="message_list" class="list-unstyled">
                            <li class="left clearfix">
                                <span class="chat-img1 pull-left">
                                <img src="/img/icon-user-default.png" alt="User Avatar" class="img-circle">
                                </span>
                                <div class="chat-body1 clearfix">
                                    <p>Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia.</p>
                                    <div class="chat_time pull-right">09:40PM</div>
                                </div>
                            </li>
                            <li class="left clearfix admin_chat">
                                <span class="chat-img1 pull-right">
                                <img src="/img/icon-user-default.png" alt="User Avatar" class="img-circle">
                                </span>
                                <div class="chat-body1 clearfix">
                                    <p>Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia.</p>
                                    <div class="chat_time pull-left">09:40PM</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <!--chat_area-->
                    <div class="message_write">
                        <textarea id="chat_input" class="form-control" placeholder="type a message"></textarea>
                        <div class="clearfix">
                        </div>
                        <div id="" class="chat_bottom">
                            <a href="#" class="pull-right btn btn-success" id="send-btn">Send</a>
                        </div>
                    </div>
                </div>
            </div>
            <!--message_section-->
        </div>
    </div>
</div>
<script src="/socket.io/socket.io.js"></script>
<script>
    var socket = io.connect('http://localhost:8080');

    //http://localhost:8080/clientid/chat -- window.location.pathname = /clientid/chat
    socket.on('connect', function (data) {
        var clientid = window.location.pathname.split('/')[1];
        socket.emit('login', clientid);  
    });

    socket.on("add group", function (groupid) {
        var groupLi = $('<li class="left clearfix"><span class="chat-img pull-left"><img src="/img/icon-user-default.png" alt="User Avatar" class="img-circle"></span><div class="chat-body clearfix"><div class="header_sec"><strong class="primary-font">'+groupid+'</strong><strong class="pull-right">09:45AM</strong></div><div class="contact_sec"><strong class="primary-font">(123) 123-456</strong> <span class="badge pull-right">3</span></div></div></li>').data('groupid', groupid);
        $('#group_list').append(groupLi);
    });


    socket.on('receive', function (message) {
        var messageLi = $('<li class="left clearfix"><span class="chat-img1 pull-left"><img src="/img/icon-user-default.png" alt="User Avatar" class="img-circle"></span><div class="chat-body1 clearfix"><p>'+ message +'</p><div class="chat_time pull-right">09:40PM</div></div></li>').data('message', message);

       $('#message_list').append(messageLi);
    });

    socket.on('self_receive', function (message) {
    	var messageLi = $('<li class="left clearfix admin_chat"><span class="chat-img1 pull-right"><img src="/img/icon-user-default.png" alt="User Avatar" class="img-circle"></span><div class="chat-body1 clearfix"><p>'+ message +'</p><div class="chat_time pull-left">09:40PM</div></div></li>').data('message', message);
    	$('#message_list').append(messageLi);
    });


    $('#createButton').on('click',function (e) {
        e.preventDefault();
        var groupid = $('#groupid_input').val();
        $('#groupid_input').val('');
        socket.emit('createGroup', groupid);
    });

    $('#joinButton').on('click',function (e) {
        e.preventDefault();
        var groupid = $('#join_input').val();
        $('#join_input').val('');
        socket.emit('joinGroup', groupid);
        $("#message_list").html("");
    });

    $('#send-btn').on('click',function (e){
    	e.preventDefault();
		var message = $('#chat_input').val();
		$('#chat_input').val('');
		socket.emit('message', message);

    	//insertMessage('me: ' + message + ' -->');
  });
</script>
</body>
</html>